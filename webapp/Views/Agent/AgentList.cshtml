@model IEnumerable<webapp.Models.AgentViewModel>
@{
	var agentCount = Model.Count();
	var agentLabel = agentCount <= 1 ? "Agent Found" : "Agents Found";
	var filters = ViewBag.Filters as webapp.Models.AgentViewModel;
}

<div class="page-title" style="background:#017efa url('@Url.Content("~/img/page-title.png")') no-repeat;">
	<div class="container">
		<div class="row">
			<div class="col-lg-12 col-md-12">

				<h2 class="ipt-title">All Agents</h2>
				<span class="ipn-subtitle">Lists of our all expert agents</span>

			</div>
		</div>
	</div>
</div>

<section>

	<div class="container">
		<div class="row">

			<!-- Side Search -->
			<div class="col-xl-4 col-lg-4 col-md-12 col-sm-12">
				<div class="page-sidebar p-0">
					<a class="filter_links" data-bs-toggle="collapse" href="#fltbox" role="button" aria-expanded="false" aria-controls="fltbox">Open Advance Filter<i class="fa fa-sliders-h ml-2"></i></a>
					<div class="collapse" id="fltbox">
						<!-- Find New Property -->
						<form method="get" asp-action="AgentList" class="sidebar-widgets p-4">

							<div class="form-group">
								<input type="text" placeholder="Agent Name" id="name" name="Name" class="form-control" value="@filters?.Name" />
							</div>

							<div class="form-group">
								<select id="location" name="Location" class="form-control"></select>
							</div>

							<div class="row">
								<div class="col-lg-12 col-md-12 col-sm-12 pt-4">
									<button class="btn btn-primary rounded full-width font--medium">Submit Search</button>
								</div>
							</div>

						</form>
					</div>
				</div>
				<!-- Sidebar End -->
			</div>

			<!-- All Lists -->
			<div class="col-xl-8 col-lg-8 col-md-12 col-sm-12">
				<div class="row">
					<div class="col-lg-12 mb-4">
						<div class="p-3 bg-white rounded border d-flex align-items-center justify-content-between">
							<div class="plc-vert-1 font--bold">
								<span class="small">@agentCount @agentLabel</span>
							</div>
							<div class="plc-vert-2">
								<div class="btn-group" role="group">
									<input type="radio" class="btn-check" name="viewpart" id="gridview" checked>
									<label class="btn btn-outline-primary btn-sm font--medium" for="gridview"><i class="fa-solid fa-border-none me-1"></i>Grid</label>

									<input type="radio" class="btn-check" name="viewpart" id="listview">
									<label class="btn btn-outline-primary btn-sm font--medium" for="listview"><i class="fa-solid fa-bars me-1"></i>List</label>
								</div>
							</div>
						</div>
					</div>
				</div>

				<div class="row gx-3 gy-4">
					@foreach (var agent in Model)
					{
						<div class="col-lg-12">
							<div class="agent-list-block border">
								<div class="agent-list-fliop">
									<div class="agent-list-thumb">
										<a asp-controller="Agent" asp-action="AgentDetails"><img src="https://via.placeholder.com/650x650" class="img-fluid rounded" alt=""></a>
										@* <span class="verify-icon"><i class="fa-solid fa-check"></i></span> *@
									</div>
								</div>
								<div class="agent-list-caption">
									<div class="agent-eliops mb-2">
										<span class="label py-2 font--medium label-light-success me-2">
											@agent.PropertyCount @((agent.PropertyCount <= 1) ? "Property" : "Properties")
										</span>
									</div>
									<div class="agent-title-uio mb-2">
										<h5 class="mb-0"><a asp-controller="Agent" asp-action="AgentDetails">@agent.Name</a></h5>
										<span class="font--medium small"><i class="fa-solid fa-location-dot me-2"></i>@agent.City, @agent.State</span>
									</div>
									<div class="agent-yytr small font--medium mb-3">
										<p class="truncate-multi-line">
											@agent.About
										</p>
									</div>
									<div class="single-button">
										<button type="button" class="btn btn-md font--bold btn-light-warning me-2"><i class="fa-solid fa-phone me-2"></i>@agent.PhoneNumber</button>
										<button type="button" class="btn btn-md font--bold btn-light-success" data-bs-toggle="modal" data-bs-target="#message"><i class="fa-solid fa-paper-plane me-2"></i>Send Message</button>
									</div>
								</div>
							</div>
						</div>
					}
				</div>

			</div>

		</div>

	</div>
</section>

<div class="modal fade" id="message" tabindex="-1" role="dialog" aria-labelledby="messagemodal" aria-hidden="true">
	<div class="modal-dialog modal-dialog-centered message-pop-form" role="document">
		<div class="modal-content" id="messagemodal">
			<span class="mod-close" data-bs-dismiss="modal" aria-hidden="true"><i class="fas fa-close"></i></span>
			<div class="modal-body">
				<div class="text-center">
					<h2 class="mb-0">Say Hi,</h2>
					<h4 class="mb-0">Mr. Dhananjay Preet</h4>
					<a class="text-success font--bold" href="tel:4048651904">(404) 865-1904</a>
				</div>
				<div class="message-form">
					<form>

						<div class="row">

							<div class="col-lg-12 col-md-12">
								<div class="form-group">
									<label>Message</label>
									<textarea class="form-control ht-60">I'm interested in 5689 Resot Relly, Canada. Please send me current availability and additional details.</textarea>
								</div>
							</div>

							<div class="col-lg-12 col-md-12">
								<div class="form-group">
									<label>Email*</label>
									<input type="email" class="form-control">
								</div>
							</div>

							<div class="col-lg-12 col-md-12">
								<div class="form-group">
									<label>Phone</label>
									<input type="text" class="form-control">
								</div>
							</div>

						</div>

						<div class="default-terms_wrap mb-3">
							<div class="default-terms_flex">
								<div class="form-check form-check-inline">
									<input class="form-check-input" type="checkbox" id="msg" value="option1">
									<label class="form-check-label small font--medium" for="msg">By submitting this form, you agree to our <a href="JavaScript:Void(0);" title="Terms of Service" class="theme-cl font--medium">Terms of Service</a> and <a href="JavaScript:Void(0);" title="Privacy Policy" class="theme-cl font--medium">Privacy Policy</a>.</label>
								</div>
							</div>
						</div>

						<div class="form-group">
							<button type="submit" class="btn full-width btn-primary">Send Message</button>
						</div>

					</form>
				</div>
			</div>
		</div>
	</div>
</div>

@section Scripts {
	<script>
		$(document).ready(function () {
			$('#location').select2({
				theme: 'bootstrap-5',
				placeholder: 'Location',
				minimumInputLength: 2,
				width: '100%',
				selectionCssClass: 'nice-select select-normal',
				ajax: {
					url: '@Url.Action("GetLocations", "Agent")',
					dataType: 'json',
					delay: 250,
					data: function (params) {
						return {
							term: params.term
						};
					},
					processResults: function (data) {
						return {
							results: $.map(data, function (item) {
								return {
									id: item.value,
									text: item.label
								};
							})
						};
					},
					cache: true
				}
			});
		});

		@if (!string.IsNullOrEmpty(filters?.Location))
		{
			<text>
				var selectedLocation = '@filters.Location';
				if (selectedLocation) {
					var newOption = new Option(selectedLocation, selectedLocation, true, true);
					$('#location').append(newOption).trigger('change');
				}
			</text>
		}

	</script>
}
